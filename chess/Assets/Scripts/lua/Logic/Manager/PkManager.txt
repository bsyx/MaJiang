--Pk管理器
PkManager = {};
local this = PkManager;

this.paiDis = 40.0;
this.paiDisCam = -10.0;

--找到自己
function PkManager.getSelf(pkPlayers)
	for key,player in pairs(pkPlayers) do
		if(player.name == Player:GetInstance().name) then
			return player;
		end
	end
end

--转换所有玩家的位置
function PkManager.changePlayersPos(pkPlayers,selfPos)
	local players = {};
	for key,player in pairs(pkPlayers) do
		if(player.pos == selfPos) then
			player.pos = 1;
		elseif(player.pos > selfPos) then
			player.pos = player.pos - selfPos + 1;
		else
			player.pos = player.pos + selfPos + 1;
		end
		players[player.pos] = player;
	end
	return players;
end

--转换特定位置
function PkManager.changePos(pos,selfPos)
	if(pos == selfPos) then
		return 1;
	elseif(player.pos > selfPos) then
		return pos - selfPos + 1;
	else
		return pos + selfPos + 1;
	end
end

--根据玩家索引获取位置
function PkManager.getPosByIndex(index,length)
	local dis = math.getIntPart(length / 2) * -this.paiDis;
	if(index ~= 1) then
		dis = (index - 1) * -10;
	end
	if(index == 1) then
		return Vector3.New(dis,-130.0,0.0);
	elseif(index == 2) then
		return Vector3.New(320.0,0.0,0.0);
	elseif(index == 3) then
		return Vector3.New(dis,130.0,0.0);
	else
		return Vector3.New(-320.0,0.0,0.0);
	end
end

--获取玩家的牌的本地位置
function PkManager.getPaiLocalPosition(index,originPos,pos)
	local dis = (index - 1) * this.paiDis;
	if(pos ~= 1) then
		dis = (index - 1) * 10;
	end
	local PlayerPos = nil;
	if(pos == 1 or pos == 3) then
		if(pos == 1) then
			PlayerPos = Vector3.New(originPos.x + dis,-130.0,0.0);
		else
			PlayerPos = Vector3.New(originPos.x + dis,130.0,0.0);
		end
	else
		if(pos == 2) then
			PlayerPos = Vector3.New(320.0 - dis,0.0,0.0);
		else
			PlayerPos = Vector3.New(-320.0+ dis,0.0,0.0);
		end
	end
	return PlayerPos;
end

--获取图片的名称
function PkManager.getPaiPicName(type,value)
	local name = '';
	if(type == 1) then
		name = "HTT"..tostring(value);
	elseif(type == 2) then
		name = "HT"..tostring(value);
	elseif(type == 3) then
		name = "FP"..tostring(value);
	else
		name = "MH"..tostring(value);
	end
	log("======pai name====="..tostring(name));
	return name;
end

--根据数字获取牌的字符
function PkManager.getStrByPaiValue(value)
	if(value == "1") then
		return "A";
	elseif(value == "11") then
		return "J";
	elseif(value == "12") then
		return "Q";
	elseif(value == "13") then
		return "K";
	else
		return tostring(value);
	end
end

--将出牌转成字符串
function PkManager.convertPaisToStr(pais)
	local str = '';
	for key,pai in pairs(pais) do
		str = str..tostring(pai.type).."_"..tostring(pai.value)..";";
	end
	return str;
end

--重新计算玩家牌的位置
function PkManager.resetPaisPos(paiTrans,pkPlayer)
	local pos = pkPlayer.pos;
	local paiLength = 0;
	for key,paiTran in pairs(paiTrans) do
		paiLength = paiLength + 1;
	end
	local originPos = this.getPosByIndex(pos,paiLength);
	
	for i=1,paiLength do
		local paiTran = paiTrans[i];
		local targetPos = PkManager.getPaiLocalPosition(i,originPos,pos);
		paiTran.transform.localPosition = targetPos;
	end
end